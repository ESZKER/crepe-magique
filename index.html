<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crepe Magique</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #fffaf7;
    color: #4b2e2b;
    margin: 0;
    padding: 0;
  }
  /* Header */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 20px;
    background-color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    height: 120px;
    overflow: hidden;
  }
  header img {
    height: 140px;
    width: auto;
    object-fit: contain;
    transform: scale(1.2);
    margin-top: -10px;
  }
  button#viewOrdersBtn {
    background: none;
    border: none;
    color: #4b2e2b;
    font-size: 16px;
    cursor: pointer;
    font-weight: 600;
  }
  /* Banner */
  .banner {
    height: 50vh;
    background-image: url('images/Banner.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  /* Main title */
  h1 {
    text-align: center;
    margin-top: 20px;
    color: #3a1e1b;
  }
  /* Main layout */
  main {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 30px;
    padding: 30px 50px;
  }
  /* Menu items */
  .menu {
    flex: 2;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
  }
  .item {
    background-color: #fff;
    border: 1px solid #e0cfc2;
    border-radius: 12px;
    padding: 10px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    transition: transform 0.2s;
  }
  .item:hover {
    transform: translateY(-3px);
  }
  .item img {
    width: 100%;
    border-radius: 12px;
    height: 160px;
    object-fit: cover;
  }
  .item h2 {
    margin: 10px 0 5px;
    font-size: 18px;
  }
  .item p {
    font-size: 13px;
    color: #6a4a42;
  }
  .item button {
    background-color: #c9a07b;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 8px;
  }
  /* Cart */
 
.cart {
  flex: 1;
  background-color: #fff;
  padding: 20px;
  border: 1px solid #e0cfc2;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  position: sticky;
  top: 20px;
}

.cart h2 {
  text-align: center;
  color: #3a1e1b;
  margin-bottom: 20px;
}

.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #fdf8f5;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #e0cfc2;
  margin-bottom: 10px;
}

.cart-item-info {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  flex: 1;
}

.cart-item-info span {
  font-weight: 600;
  color: #4b2e2b;
}

.cart-item-info small {
  font-size: 12px;
  color: #7c6a63;
}

.cart-item-price {
  font-weight: bold;
  color: #3a1e1b;
  margin-right: 10px;
}

.quantity-controls {
  display: flex;
  align-items: center;
  gap: 6px;
}

.quantity-btn {
  background-color: #d4b7a2;
  border: none;
  border-radius: 6px;
  color: #4b2e2b;
  font-weight: bold;
  width: 26px;
  height: 26px;
  cursor: pointer;
  transition: background 0.2s;
}

.quantity-btn:hover {
  background-color: #c29b7d;
}

  .thankyou {
    text-align: center;
    margin-top: 10px;
    color: green;
    display: none;
    font-weight: bold;
  }
  select, input, textarea {
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-top: 5px;
  }
  .submit-btn, .clear-btn {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 600;
  }
  .submit-btn {
    background: #4b2e2b;
    color: white;
  }
  .clear-btn {
    background: #d4b7a2;
    color: #4b2e2b;
  }
  /* Footer */
  footer {
    text-align: center;
    font-size: 14px;
    padding: 10px;
    background-color: #f5e7d8;
    margin-top: 30px;
  }
  /* Modals */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 320px;
    text-align: left;
    position: relative;
  }
  .modal-content h3 {
    margin-top: 0;
    text-align: center;
  }
  .modal-content button {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
    border: none;
    border-radius: 6px;
    background-color: #4b2e2b;
    color: white;
    cursor: pointer;
  }

.topping-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #fff;
  border-radius: 10px;
  padding: 12px 16px;
  margin-bottom: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: background 0.2s ease;
}

.topping-option:hover {
  background: #f9f2ec;
}

.topping-option span {
  font-size: 16px;
  color: #4a2c2a;
}
  .topping-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 6px 0;
  padding: 6px 8px;
  border: 1px solid #ddd;
  border-radius: 6px;
  background: #f9f6f4;
  font-size: 14px;
}

.topping-option input[type="checkbox"] {
  transform: scale(1.3);
  cursor: pointer;
  margin-left: 20px;
}
  /* Rating / Review Star Animation */
  .rating .star {
    display: inline-block;
    font-size: 28px;
    color: #b88;
    cursor: pointer;
    transition: transform 0.3s ease, color 0.3s ease;
  }
  .rating .star:hover {
    transform: scale(1.3);
    color: #ffb400;
    animation: pop 0.5s ease;
  }
  .rating .star.selected {
    color: #ffb400;
    animation: fillStar 0.6s ease forwards;
  }
  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.4); }
    100% { transform: scale(1.3); }
  }
  @keyframes fillStar {
    0% { color: #b88; transform: scale(1); }
    50% { color: #ffb400; transform: scale(1.2); }
    100% { color: #ffb400; transform: scale(1); }
  }
</style>
</head>
<body>

<!-- Header -->
<header>
  <div style="display: flex; align-items: center; gap: 15px;">
    <img src="images/logo.png" alt="Crepe Magique Logo">
    <h1 style="font-family: 'Playfair Display', serif; font-size: 32px; color: #4b2e2b; margin: 0;">Crepe Magique</h1>
  </div>
  <button id="viewOrdersBtn">Dashboard (Admins Only)</button>
</header>

<!-- Banner -->
<section class="banner"></section>

<!-- Main Title -->
<h1 style="text-decoration: underline;">Our Special Menu‚ù§Ô∏è</h1>

<!-- Main -->
<main>
  <div class="menu">
    <div class="item">
      <img src="images/menu-1.jpg" alt="French Crepe">
      <h2>French Crepe ‚Äì ·üõ3500</h2>
      <p>Soft and golden crepe drizzled with rich chocolate and creamy condensed milk ‚Äî sweet and irresistible.</p>
      <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
  <button onclick="openToppingModal()" id="crepeBtn">Add to Order</button>
  <span id="crepeStock" style="color:green; font-size:14px; font-weight:600;">(20 left)</span>
</div>

    </div>
    <div class="item">
      <img src="images/menu-2.jpg" alt="Buchimgae">
      <h2>Buchimgae ‚Äì ·üõ6000</h2>
      <p>Crispy Korean-style pancake made with savory batter and vegetables, pan-fried to perfection.</p>
     <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
  <button onclick="addToCart('Buchimgae', 6000)" id="buchimgaeBtn">Add to Order</button>
  <span id="buchimgaeStock" style="color:green; font-size:14px; font-weight:600;">(20 left)</span>
</div>

    </div>
  </div>

  <div class="cart" id="cartSection">
    <h2>Your Order</h2>
    <div id="cartItems"></div>
    <p><strong>Total: ·üõ<span id="cartTotal">0</span></strong></p>
    <div>
      <label for="customerName">Your Name:</label>
      <input type="text" id="customerName" placeholder="Enter your name">
      <label for="customerPhone">Contact Number:</label>
      <input type="tel" id="customerPhone" placeholder="Enter your phone number">
      <label for="yearSelect">Select Year:</label>
      <select id="yearSelect">
        <option value=""></option>
        <option>IP Student</option>
        <option>Year 1</option>
        <option>Year 2</option>
        <option>Year 3</option>
        <option>Year 4</option>
        <option>Staff</option>
      </select>
      <label for="pickupTime">Pickup Time:</label>
      <select id="pickupTime">
        <option value=""></option>
        <option>12:00-1:00pm</option>
        <option>5:00-6:00pm</option>
      </select>
    </div>
    <button class="submit-btn" onclick="submitOrder()">Submit Order</button>
    <button class="clear-btn" onclick="clearCart()">Clear Cart</button>
    <div class="thankyou" id="thankyouBox">Thank you! Please pay at the counter during break.</div>
  </div>
</main>

<!-- Topping Modal for French Crepe -->
<div id="toppingModal" class="modal">
  <div class="modal-content">
    <div style="display:flex; justify-content:flex-end;">
      <div style="width:30px; height:30px; background:#c9a07b; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="toppingModal.style.display='none'">
        ‚úñ
      </div>
    </div>
    <h3>Select Toppings </h3>
    	<div id="toppingOptions">
  	<div class="topping-option">
   	 <span>Chocolate Sauce (·üõ500)</span>
  	  <input type="checkbox" value="Chocolate Sauce (·üõ500)" data-price="500">
 	 </div>
 	 <div class="topping-option">
   	 <span>Condensed Milk (·üõ500)</span>
   	 <input type="checkbox" value="Condensed Milk (·üõ500)" data-price="500">
	  </div>
 	 <div class="topping-option">
 	   <span>Icing Sugar (FREE)</span>
  	  <input type="checkbox" value="Icing Sugar (FREE)" data-price="0">
  </div>
</div>

    <button onclick="confirmToppings()">Add to Cart</button>
  </div>
</div>

<!-- Out of Stock Modal -->
<div id="soldOutModal" class="modal">
  <div class="modal-content" style="text-align:center;">
    <div style="display:flex; justify-content:flex-end;">
      <div style="width:30px; height:30px; background:#c9a07b; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="closeSoldOutModal()">
        ‚úñ
      </div>
    </div>
    <h3 style="color:#4b2e2b;">Sorry!</h3>
    <p id="soldOutMessage" style="color:#6a4a42; font-size:15px;">We have no more items available today.</p>
    <button onclick="closeSoldOutModal()" style="background:#4b2e2b; color:white; border:none; padding:8px; border-radius:6px; width:100%; cursor:pointer;">Okay</button>
  </div>
</div>

<!-- Review Modal -->
<div id="reviewModal" class="modal">
  <div class="modal-content">
    <div style="display:flex; justify-content:flex-end;">
      <div style="width:30px; height:30px; background:#b88; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="closeReviewModal()">
        ‚úñ
      </div>
    </div>
    <h3 id="reviewTitle">Rate Us <3</h3>
    <div class="rating" id="ratingStars" style="margin:10px 0;"></div>
    <div style="margin-top:8px;">
      <label for="reviewComment">Comment (optional)</label>
      <textarea id="reviewComment" placeholder="Tell us what you liked..." style="width:100%; padding:8px; margin-top:4px; border-radius:6px; border:1px solid #ccc;"></textarea>
      <button style="width:100%; margin-top:10px; background:#b88; color:#fff; border:none; padding:10px; border-radius:8px; cursor:pointer;" onclick="submitReview()">Submit Review</button>
    </div>
  </div>
</div>

<footer>
  <div style="display:flex; flex-direction:column; justify-content:center; align-items:center; gap:10px;">
    <button onclick="openReviewModal()" style="padding:8px 12px; border-radius:8px; border:none; background:#b88; color:#fff; cursor:pointer;">Rate us ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</button>
    <div id="avgRatingDisplay" style="display:none;"></div>
    <div id="reviewComments" style="display:none;"></div>
  </div>
  ¬© 2025 Crepe Magique | Made with ‚ù§Ô∏è
</footer>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
  import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB6DxMKy1y28t4xtvw0SMcx3K4pivB7grw",
    authDomain: "crepe-magique.firebaseapp.com",
    projectId: "crepe-magique",
    storageBucket: "crepe-magique.firebasestorage.app",
    messagingSenderId: "175773010517",
    appId: "1:175773010517:web:170168816a70efa825a2dc",
    measurementId: "G-J3S8GPYLMD"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getDatabase(app);

  // ‚úÖ Make these functions visible to your main script
  window.db = db;
  window.ref = ref;
  window.push = push;
</script>


<script>
// --- Stock Limit Feature (persistent & admin-controlled) ---
// Safely load existing stock from localStorage
let stockRaw = localStorage.getItem('stock');
let stock;
try {
  stock = stockRaw ? JSON.parse(stockRaw) : null;
} catch (e) {
  stock = null;
}

if (!stock || typeof stock !== 'object' || Object.keys(stock).length === 0) {
  // No valid stock found ‚Üí treat everything as sold out.
  stock = { 'French Crepe': 0, 'Buchimgae': 0 };
  console.log("No stock found ‚Äî showing all items as SOLD OUT üíî");
} else {
  console.log("Loaded existing stock:", stock);
}

// Update display whenever stock changes in Dashboard
window.addEventListener('storage', (e) => {
  if (e.key === 'stock') {
    try {
      const newStock = e.newValue ? JSON.parse(e.newValue) : null;
      if (newStock && typeof newStock === 'object') {
        stock = newStock;
        console.log('Stock updated from dashboard:', stock);
      }
    } catch (err) {
      console.warn('Failed to parse updated stock:', err);
    }
    if (typeof updateStockDisplay === 'function') updateStockDisplay();
  }
});

// --- Listen for dashboard broadcasts (real-time cross-tab updates) ---
try {
  const bc = new BroadcastChannel('crepe_channel');
  bc.addEventListener('message', (ev) => {
    if (ev?.data?.type === 'stock_update') {
      // update local stock copy and refresh display
      const newStock = ev.data.stock;
      if (newStock && typeof newStock === 'object') {
        stock = newStock;
        // also persist locally to ensure consistent state
        try { localStorage.setItem('stock', JSON.stringify(newStock)); } catch (e) {}
        if (typeof updateStockDisplay === 'function') updateStockDisplay();
      }
    }
  });
  // We won't close here ‚Äî keep open to receive more updates while page is active
} catch (err) {
  console.warn('BroadcastChannel not supported on this browser:', err);
}

// Initial display update when page first loads
window.addEventListener('DOMContentLoaded', () => {
  if (typeof updateStockDisplay === 'function') updateStockDisplay();
});


// Update display if admin changes stock in dashboard (storage event)
window.addEventListener('storage', (e) => {
  if (e.key === 'stock') {
    try {
      const newStock = e.newValue ? JSON.parse(e.newValue) : null;
      if (newStock && typeof newStock === 'object') {
        stock = newStock;
        console.log('Stock updated from storage event:', stock);
      }
    } catch (err) {
      console.warn('Failed to parse stock from storage event', err);
    }
    if (typeof updateStockDisplay === 'function') updateStockDisplay();
  }
});





function getSoldCount(item) {
  const orders = JSON.parse(localStorage.getItem('orders') || '[]');
  return orders.reduce((sum, o) => {
    const found = o.items.find(i => i.item === item);
    return sum + (found ? found.quantity : 0);
  }, 0);
}
function checkStock(item, quantity) {
  const sold = getSoldCount(item);
  const inCart = cart
    .filter(i => i.item === item)
    .reduce((t, i) => t + i.quantity, 0);
  const totalRequested = sold + inCart + quantity;
  return totalRequested <= stock[item];
}

// --- Sold Out Modal Control ---
function openSoldOutModal(message) {
  document.getElementById('soldOutMessage').textContent = message;
  document.getElementById('soldOutModal').style.display = 'flex';
}
function closeSoldOutModal() {
  document.getElementById('soldOutModal').style.display = 'none';
}
window.onclick = e => {
  const modal = document.getElementById('soldOutModal');
  if (e.target === modal) modal.style.display = 'none';
};

// --- Update Stock Display ---
function updateStockDisplay() {
  const crepeSold = getSoldCount('French Crepe');
  const buchimgaeSold = getSoldCount('Buchimgae');

  // Safely count items still in the current cart (may be 0 right after submit)
  const crepeInCart = Array.isArray(cart)
    ? cart.filter(i => i.item === 'French Crepe').reduce((t, i) => t + i.quantity, 0)
    : 0;
  const buchimgaeInCart = Array.isArray(cart)
    ? cart.filter(i => i.item === 'Buchimgae').reduce((t, i) => t + i.quantity, 0)
    : 0;

  // Calculate remaining stock, but never below zero
  const crepeLeft = Math.max(0, stock['French Crepe'] - crepeSold - crepeInCart);
  const buchimgaeLeft = Math.max(0, stock['Buchimgae'] - buchimgaeSold - buchimgaeInCart);

  const crepeSpan = document.getElementById('crepeStock');
  const buchimgaeSpan = document.getElementById('buchimgaeStock');
  const crepeBtn = document.getElementById('crepeBtn');
  const buchimgaeBtn = document.getElementById('buchimgaeBtn');

  // French Crepe display
  if (crepeLeft > 0) {
    crepeSpan.textContent = `(${crepeLeft} left)`;
    crepeSpan.style.color = "green";
    crepeBtn.disabled = false;
    crepeBtn.style.opacity = "1";
  } else {
    crepeSpan.textContent = "(Sold Out üôèüèª)";
    crepeSpan.style.color = "red";
    crepeBtn.disabled = true;
    crepeBtn.style.opacity = "0.6";
  }

  // Buchimgae display
  if (buchimgaeLeft > 0) {
    buchimgaeSpan.textContent = `(${buchimgaeLeft} left)`;
    buchimgaeSpan.style.color = "green";
    buchimgaeBtn.disabled = false;
    buchimgaeBtn.style.opacity = "1";
  } else {
    buchimgaeSpan.textContent = "(Sold Out üôèüèª)";
    buchimgaeSpan.style.color = "red";
    buchimgaeBtn.disabled = true;
    buchimgaeBtn.style.opacity = "0.6";
  }
}



let cart = [];
const toppingModal = document.getElementById('toppingModal');

// --- French Crepe Topping Modal ---
function openToppingModal(){ toppingModal.style.display="flex"; }
function confirmToppings(){
  const checkboxes = toppingModal.querySelectorAll('input[type="checkbox"]:checked');
  const toppings = Array.from(checkboxes).map(cb=>cb.value);
  const toppingCost = Array.from(checkboxes).reduce((sum, cb)=>sum+Number(cb.dataset.price),0);
  addToCart('French Crepe', 3500+toppingCost, toppings);
  toppingModal.style.display='none';
  toppingModal.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
}
window.onclick = e => { if(e.target==toppingModal) toppingModal.style.display='none'; }

// --- Cart Logic ---
function addToCart(item, price, toppings=[]) {
  if (!checkStock(item, 1)) {
  openSoldOutModal(`but we have no more ${item}s available today.`);
  return;
}


  const existing = cart.find(i => i.item === item && JSON.stringify(i.toppings) === JSON.stringify(toppings));
  if (existing) existing.quantity += 1;
  else cart.push({ item, price, quantity: 1, toppings });
  renderCart();
  updateStockDisplay();
}
function changeQuantity(idx, change){

  if (change > 0) {
    const itemName = cart[idx].item;
 
    if (!checkStock(itemName, 1)) {
      if (typeof openSoldOutModal === 'function') {
        openSoldOutModal(`Sorry, we have no more ${itemName}s available today.`);
      } else {
        alert(`Sorry, we have no more ${itemName}s available today.`);
      }
      return;
    }
  }

  cart[idx].quantity += change;
  if (cart[idx].quantity <= 0) cart.splice(idx, 1);
  renderCart();
  if (typeof updateStockDisplay === 'function') updateStockDisplay();
}

function renderCart() {
  const cartDiv = document.getElementById('cartItems');
  if (cart.length === 0) {
    cartDiv.innerHTML = "";
    document.getElementById('cartTotal').textContent = 0;
    return;
  }

  cartDiv.innerHTML = cart.map((i, idx) => {
    const toppings = i.toppings.length
      ? `<small>+ ${i.toppings.join(', ')}</small>`
      : '';
    return `
      <div class="cart-item">
        <div class="cart-item-info">
          <span>${i.item}</span>
          ${toppings}
        </div>
        <div class="cart-item-price">·üõ${i.price}</div>
        <div class="quantity-controls">
          <button class="quantity-btn" onclick="changeQuantity(${idx}, -1)">‚Äì</button>
          <span>${i.quantity}</span>
          <button class="quantity-btn" onclick="changeQuantity(${idx}, 1)">+</button>
        </div>
      </div>
    `;
  }).join('');

  document.getElementById('cartTotal').textContent =
    cart.reduce((t, i) => t + i.price * i.quantity, 0);
}


function clearCart(){ if(confirm("Clear your cart?")){ cart=[]; renderCart(); } }
function submitOrder() {
  const name = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  const year = document.getElementById('yearSelect').value;
  const pickupTime = document.getElementById('pickupTime').value;

  if (!name || !phone || !year || !pickupTime || cart.length === 0) {
    alert('Please fill out all fields and add items.');
    return;
  }

  const total = cart.reduce((t, i) => t + i.price * i.quantity, 0);
  const newOrder = {
    name,
    phone,
    year,
    pickupTime,
    total,
    items: cart,
    time: new Date().toLocaleString(),
  };

  // Push to Firebase Realtime Database
  const db = window.db;
  const ordersRef = ref(db, 'orders');
  push(ordersRef, newOrder)
    .then(() => {
      console.log("Order saved to Firebase ");
      cart = [];
      renderCart();
      updateStockDisplay();
      const msg = document.getElementById('thankyouBox');
      msg.style.display = 'block';
      setTimeout(() => msg.style.display = 'none', 4000);
    })
    .catch((error) => {
      console.error(" Failed to save order:", error);
      alert("Failed to submit order. Please try again.");
    });
}


// --- Admin Dashboard ---
document.getElementById('viewOrdersBtn').addEventListener('click',()=>{
  const pass = prompt('Enter admin password:');
  if(pass==='Patricia') window.location.href='dashboard.html';
});

// --- Review System ---
let selectedRating = 0;
function openReviewModal(){
  document.getElementById('reviewModal').style.display='flex';
  const starsDiv = document.getElementById('ratingStars');
  starsDiv.innerHTML='';
  for(let i=1;i<=5;i++){
    const star = document.createElement('span');
    star.textContent='‚òÖ';
    star.className='star';
    star.onclick = ()=>{ selectedRating=i; updateStars(); };
    starsDiv.appendChild(star);
  }
}
function updateStars(){
  const stars = document.querySelectorAll('#ratingStars .star');
  stars.forEach((s,i)=> s.classList.toggle('selected', i<selectedRating));
}
function closeReviewModal(){ document.getElementById('reviewModal').style.display='none'; }
function submitReview(){
  const comment = document.getElementById('reviewComment').value.trim();
  if(selectedRating===0){ alert('Please select a star rating.'); return; }
  const reviews = JSON.parse(localStorage.getItem('reviews')||'[]');
  reviews.push({rating:selectedRating, comment});
  localStorage.setItem('reviews',JSON.stringify(reviews));
  document.getElementById('reviewComment').value='';
  selectedRating=0;
  closeReviewModal();
  displayReviews();
  updateStockDisplay();

}

// Hide written comments on menu page (keep only average rating)
function displayReviews(){
  const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
  if (reviews.length === 0) return;

  const avg = (reviews.reduce((t, r) => t + r.rating, 0) / reviews.length).toFixed(1);
  const displayAvg = document.getElementById('avgRatingDisplay');
  displayAvg.style.display = 'block';
  displayAvg.textContent = `Average Rating: ${avg}  (${reviews.length} reviews)`;

  // Hide written customer comments under the menu
  const commentsDiv = document.getElementById('reviewComments');
  commentsDiv.style.display = 'none';
  commentsDiv.innerHTML = '';
}

displayReviews();
</script>
	
</body>
</html>






